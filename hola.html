<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #map-canvas {
            height:400px;
        }
        #map {
            height: 800px;
            }
/* Optional: Makes the sample page fill the window. */
    </style>
</head>
<body>
    <div>
        <div id="map"></div>
        <button id="REC">RETROCEDER</button>
    </div>
</body>
<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDWNKzllkFkkJdm6JeA5iAWK9rpZUZr2Q&callback=initMap%22%3E"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    $('#REC').on('click', function(){
        // waypts.pop();
        // removeLine();
        //flightPath.setMap(map);
        //flightPath.setMap(map);
        removePoint(markers[markers.length - 1]);
        
    });
    var map, polyline, markers = new Array();

        function initialize() {

            var mapOptions = {
                zoom: 16,
                center: new google.maps.LatLng(-33.611039, -70.718683),
                mapTypeId: google.maps.MapTypeId.TERRAIN
            };

            map = new google.maps.Map(document.getElementById('map'),
                mapOptions);

            polyline = new google.maps.Polyline({
                strokeColor: 'red',
                strokeWeight: 1,
                map: map
            });

            google.maps.event.addListener(map, 'click', function (event) {

                addPoint(event.latLng);
            });
        }

        function removePoint(marker) {

            for (var i = 0; i < markers.length; i++) {

                if (markers[i] === marker) {

                    markers[i].setMap(null);
                    markers.splice(i, 1);

                    polyline.getPath().removeAt(i);
                }
            }
        }

        function addPoint(latlng) {

            var marker = new google.maps.Marker({
                position: latlng,
                map: map
            });

            markers.push(marker);

            polyline.getPath().setAt(markers.length - 1, latlng);

            google.maps.event.addListener(marker, 'click', function (event) {

                removePoint(marker);
            });
        }

        initialize();
        // var directionDisplay;
        // var directionsService = new google.maps.DirectionsService();
        // var map;
        // var waypts = []; 
        // var puntos = [];
        // var map;
        // var flightPath = [];

        
        // function initMap() {
        //     map = new google.maps.Map(document.getElementById('map'), {
        //         zoom: 16,
        //         center: { lat: -33.611039, lng: -70.718683 },
        //         mapTypeId: 'terrain'
        //     });
        //     google.maps.event.addListener(map, 'click', function (event) {
        //         calcRoute(parseFloat(event.latLng.lat()), parseFloat(event.latLng.lng()), map);
        //     });
        // }
        // function calcRoute(lat, lng) {
        //     waypts.push({ lat: lat, lng: lng });
        //     addLine()
        // }
        // function addLine() {
        //         flightPath = new google.maps.Polyline({
        //         path: waypts,
        //         geodesic: true,
        //         strokeColor: '#FF0000',
        //         strokeOpacity: 1.0,
        //         strokeWeight: 2
        //     });
        //     flightPath.setMap(map);
        // }

        // function removeLine() {
        //     flightPath.setMap(null);
        // }
        // initMap();

        // function initialize() {
        //     directionsDisplay = new google.maps.DirectionsRenderer({
        //         suppressMarkers: true
        //     });

        //     var myOptions = {
        //         zoom: 16,
        //         mapTypeId: google.maps.MapTypeId.ROADMAP,
        //         center:  { lat: -33.611039, lng: -70.718683 }
        //     }

        //     map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
        //     directionsDisplay.setMap(map);
        //      start = new google.maps.LatLng(-33.6193253, -70.6946863);
        //     end = new google.maps.LatLng(-33.6193253, -70.6946863);
        //     //calcRoute();
        //     google.maps.event.addListener(map, 'click', function (event) {
        //         calcRoute(parseFloat(event.latLng.lat()), parseFloat(event.latLng.lng()));
        //     });
        // }




        // function calcRoute(lat, lng) {

        //     // var waypts = [];

        //     stop = new google.maps.LatLng(lat, lng)
        //     puntos.push(stop);
        //     waypts.push({
        //         location: stop,
        //         stopover: true
        //     });

        //     start = puntos[0];
        //     end = puntos[puntos.length - 1];
        //     console.log(puntos);
        //     createMarker(start);
        //     var request = {
        //         origin: start,
        //         destination: end,
        //         waypoints: waypts,
        //         //optimizeWaypoints: true,
        //         travelMode: google.maps.DirectionsTravelMode.WALKING
        //     };
        //     directionsService.route(request, function (response, status) {
        //         if (status == google.maps.DirectionsStatus.OK) {
        //             directionsDisplay.setDirections(response);
        //             var route = response.routes[0];
        //         }
        //     });
        // }

        // function createMarker(latlng) {

        //     var marker = new google.maps.Marker({
        //         position: latlng,
        //         map: map
        //     });
        // }

        // initialize();
</script>
</html>